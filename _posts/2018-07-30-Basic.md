---
layout: post
category: data
tags: [data, python,numpy, test]
comments: true
author: Admin

---

```python
import numpy as np
import pandas as pd
```


```python
jeopardy = pd.read_csv('jeopardy.csv')
```


```python
jeopardy.head()
```




<div>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Show Number</th>
      <th>Air Date</th>
      <th>Round</th>
      <th>Category</th>
      <th>Value</th>
      <th>Question</th>
      <th>Answer</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>4680</td>
      <td>2004-12-31</td>
      <td>Jeopardy!</td>
      <td>HISTORY</td>
      <td>$200</td>
      <td>For the last 8 years of his life, Galileo was ...</td>
      <td>Copernicus</td>
    </tr>
    <tr>
      <th>1</th>
      <td>4680</td>
      <td>2004-12-31</td>
      <td>Jeopardy!</td>
      <td>ESPN's TOP 10 ALL-TIME ATHLETES</td>
      <td>$200</td>
      <td>No. 2: 1912 Olympian; football star at Carlisl...</td>
      <td>Jim Thorpe</td>
    </tr>
    <tr>
      <th>2</th>
      <td>4680</td>
      <td>2004-12-31</td>
      <td>Jeopardy!</td>
      <td>EVERYBODY TALKS ABOUT IT...</td>
      <td>$200</td>
      <td>The city of Yuma in this state has a record av...</td>
      <td>Arizona</td>
    </tr>
    <tr>
      <th>3</th>
      <td>4680</td>
      <td>2004-12-31</td>
      <td>Jeopardy!</td>
      <td>THE COMPANY LINE</td>
      <td>$200</td>
      <td>In 1963, live on "The Art Linkletter Show", th...</td>
      <td>McDonald's</td>
    </tr>
    <tr>
      <th>4</th>
      <td>4680</td>
      <td>2004-12-31</td>
      <td>Jeopardy!</td>
      <td>EPITAPHS &amp; TRIBUTES</td>
      <td>$200</td>
      <td>Signer of the Dec. of Indep., framer of the Co...</td>
      <td>John Adams</td>
    </tr>
  </tbody>
</table>
</div>




```python
jeopardy.columns
```




    Index(['Show Number', ' Air Date', ' Round', ' Category', ' Value',
           ' Question', ' Answer'],
          dtype='object')




```python
jeopardy.columns = ['Show Number', 'Air Date', 'Round', 'Category', 'Value',
       'Question', 'Answer']
```


```python
jeopardy.columns
```




    Index(['Show Number', 'Air Date', 'Round', 'Category', 'Value', 'Question',
           'Answer'],
          dtype='object')




```python
import re
def normalize_text(text):
    text = text.lower()
    text = re.sub(r'[^\w\s]','',text)
    return text

def normalize_value(text):
    text = re.sub(r'[^\w\s]','',text)
    try:
        text = int(text)
    except Exception:
        text = 0
    return text
```


```python
jeopardy['clean_question'] = jeopardy['Question'].apply(normalize_text)
jeopardy['clean_answer'] = jeopardy['Answer'].apply(normalize_text)
jeopardy['clean_value'] = jeopardy['Value'].apply(normalize_value)
```


```python
pd.to_datetime(jeopardy['Air Date'])
```




    0       2004-12-31
    1       2004-12-31
    2       2004-12-31
    3       2004-12-31
    4       2004-12-31
    5       2004-12-31
    6       2004-12-31
    7       2004-12-31
    8       2004-12-31
    9       2004-12-31
    10      2004-12-31
    11      2004-12-31
    12      2004-12-31
    13      2004-12-31
    14      2004-12-31
    15      2004-12-31
    16      2004-12-31
    17      2004-12-31
    18      2004-12-31
    19      2004-12-31
    20      2004-12-31
    21      2004-12-31
    22      2004-12-31
    23      2004-12-31
    24      2004-12-31
    25      2004-12-31
    26      2004-12-31
    27      2004-12-31
    28      2004-12-31
    29      2004-12-31
               ...    
    19969   2009-05-14
    19970   2009-05-14
    19971   2009-05-14
    19972   2009-05-14
    19973   2009-05-14
    19974   2009-05-14
    19975   2009-05-14
    19976   2009-05-14
    19977   2009-05-14
    19978   2009-05-14
    19979   2009-05-14
    19980   2009-05-14
    19981   2009-05-14
    19982   2009-05-14
    19983   2009-05-14
    19984   2009-05-14
    19985   2009-05-14
    19986   2009-05-14
    19987   2009-05-14
    19988   2000-03-14
    19989   2000-03-14
    19990   2000-03-14
    19991   2000-03-14
    19992   2000-03-14
    19993   2000-03-14
    19994   2000-03-14
    19995   2000-03-14
    19996   2000-03-14
    19997   2000-03-14
    19998   2000-03-14
    Name: Air Date, dtype: datetime64[ns]




```python
jeopardy.head()

```




<div>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Show Number</th>
      <th>Air Date</th>
      <th>Round</th>
      <th>Category</th>
      <th>Value</th>
      <th>Question</th>
      <th>Answer</th>
      <th>clean_question</th>
      <th>clean_answer</th>
      <th>clean_value</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>4680</td>
      <td>2004-12-31</td>
      <td>Jeopardy!</td>
      <td>HISTORY</td>
      <td>$200</td>
      <td>For the last 8 years of his life, Galileo was ...</td>
      <td>Copernicus</td>
      <td>for the last 8 years of his life galileo was u...</td>
      <td>copernicus</td>
      <td>200</td>
    </tr>
    <tr>
      <th>1</th>
      <td>4680</td>
      <td>2004-12-31</td>
      <td>Jeopardy!</td>
      <td>ESPN's TOP 10 ALL-TIME ATHLETES</td>
      <td>$200</td>
      <td>No. 2: 1912 Olympian; football star at Carlisl...</td>
      <td>Jim Thorpe</td>
      <td>no 2 1912 olympian football star at carlisle i...</td>
      <td>jim thorpe</td>
      <td>200</td>
    </tr>
    <tr>
      <th>2</th>
      <td>4680</td>
      <td>2004-12-31</td>
      <td>Jeopardy!</td>
      <td>EVERYBODY TALKS ABOUT IT...</td>
      <td>$200</td>
      <td>The city of Yuma in this state has a record av...</td>
      <td>Arizona</td>
      <td>the city of yuma in this state has a record av...</td>
      <td>arizona</td>
      <td>200</td>
    </tr>
    <tr>
      <th>3</th>
      <td>4680</td>
      <td>2004-12-31</td>
      <td>Jeopardy!</td>
      <td>THE COMPANY LINE</td>
      <td>$200</td>
      <td>In 1963, live on "The Art Linkletter Show", th...</td>
      <td>McDonald's</td>
      <td>in 1963 live on the art linkletter show this c...</td>
      <td>mcdonalds</td>
      <td>200</td>
    </tr>
    <tr>
      <th>4</th>
      <td>4680</td>
      <td>2004-12-31</td>
      <td>Jeopardy!</td>
      <td>EPITAPHS &amp; TRIBUTES</td>
      <td>$200</td>
      <td>Signer of the Dec. of Indep., framer of the Co...</td>
      <td>John Adams</td>
      <td>signer of the dec of indep framer of the const...</td>
      <td>john adams</td>
      <td>200</td>
    </tr>
  </tbody>
</table>
</div>




```python
def ans_in_question(row):
    split_answer = row['clean_answer'].split()
    split_question = row['clean_question'].split()
    match_count = 0
    if 'the' in split_answer:
        split_answer.remove('the')
    if len(split_answer) == 0:
        return 0
    for item in split_answer:
        if item in split_question:
            match_count += 1
            
    return match_count / len(split_answer)
```


```python
jeopardy['answer_in_question'] = jeopardy.apply(ans_in_question, axis=1)
```


```python
jeopardy['answer_in_question'].mean()
```




    0.059001965249777633



## Foundings
- The possibiliy of an-in-question is only 6%, it is better to do some extra study if a candidate wants to win.  


```python
question_overlap = []
terms_used = set()

for idx, row in jeopardy.iterrows():
    split_question = row['clean_question'].split()
    split_question = [w for w in split_question if len(w) > 5]
   
    match_count = 0
    for w in split_question:
        if w in terms_used:
            match_count += 1
    for w in split_question:
        terms_used.add(w)
    if len(split_question) > 0:
            match_count /= len(split_question)
    question_overlap.append(match_count)

jeopardy["question_overlap"] = question_overlap
jeopardy["question_overlap"].mean()
    
```




    0.69087123144218998



## Findings:
- the overlap between terms in new questions and terms in old questions is about 70%, it worths looking more into the old questions


```python
def determine_value(row):
    value = 0
    if row["clean_value"] > 800:
        value = 1
    return value

jeopardy["high_value"] = jeopardy.apply(determine_value, axis=1)
```


```python
def count_usage(term):
    low_count = 0
    high_count = 0
    for i, row in jeopardy.iterrows():
        if term in row['clean_question'].split(' '):
            if row['high_value'] == 1:
                high_count += 1
            else:
                low_count += 1
    return high_count, low_count

comparison_terms = list(terms_used)[:5]
observed_expected = []
for term in comparison_terms:
    observed_expected.append(count_usage(term))

observed_expected
```




    [(6, 10), (0, 1), (1, 0), (2, 2), (0, 1)]




```python
from scipy.stats import chisquare
import numpy as np


high_value_count = jeopardy[jeopardy["high_value"] == 1].shape[0]
low_value_count = jeopardy[jeopardy["high_value"] == 0].shape[0]

chi_squared = []

for lst in observed_expected:
    total = sum(lst)
    total_prop = total / jeopardy.shape[0]
    expected_high = total_prop*high_value_count
    expected_low = total_prop*low_value_count
    
    observed = np.array([lst[0], lst[1]])
    expected = np.array([expected_high, expected_low])
    chi_squared.append(chisquare(observed, expected))
    
chi_squared
```




    [Power_divergenceResult(statistic=0.60980005198329346, pvalue=0.43486310403216943),
     Power_divergenceResult(statistic=0.40196284612688399, pvalue=0.52607729857054686),
     Power_divergenceResult(statistic=2.4877921171956752, pvalue=0.11473257634454047),
     Power_divergenceResult(statistic=0.88975496332255899, pvalue=0.34554371914834681),
     Power_divergenceResult(statistic=0.40196284612688399, pvalue=0.52607729857054686)]



## Further exploring:
- Find a better way to eliminate non-informative words than just removing words that are less than 6 characters long. Some ideas:
    - Manually create a list of words to remove, like the, than, etc.
    - Find a list of stopwords to remove.
    - Remove words that occur in more than a certain percentage (like 5%) of questions.
- Perform the chi-squared test across more terms to see what terms have larger differences. This is hard to do currently because the code is slow, but here are some ideas:
    - Use the apply method to make the code that calculates frequencies more efficient.
    - Only select terms that have high frequencies across the dataset, and ignore the others
